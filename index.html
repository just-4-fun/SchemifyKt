<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Schemify.Kt by just-4-fun</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Schemify.Kt</h1>
      <h2 class="project-tagline">Schemification and serialization API for Kotlin</h2>
      <a href="https://github.com/just-4-fun/SchemifyKt" class="btn">View on GitHub</a>
      <a href="https://github.com/just-4-fun/SchemifyKt/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/just-4-fun/SchemifyKt/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="apis" class="anchor" href="#apis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>APIs:</h1>

<ul>
<li>
<a href="#schemification-api"><strong>Schemification API</strong></a>: Creating a scheme of a class.</li>
<li>
<a href="#serialization-api"><strong>Serialization API</strong></a>: Transforming an instance of schemified class from/to other format.</li>
</ul>

<hr>

<h2>
<a id="schemification-api" class="anchor" href="#schemification-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Schemification API</h2>

<p>Structure of a class can be represented as a <strong>Scheme</strong> by mapping class fields to scheme <strong>Props</strong>.<br>
<em>In this sense scheme is a special class that represent other class structure as set of Props.</em>  </p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17268740/86bae482-563c-11e6-9178-977e9a07e615.png" alt="smf_fieldprop"></p>
</blockquote>

<p>Since the scheme of the class is <a href="#defining-scheme">defined</a> it can be used for:</p>

<ul>
<li>
<strong>serialization</strong>:

<ul>
<li>instance of that class can be read from other formats</li>
<li>instance of that class can be written to other formats.</li>
</ul>
</li>
<li>
<strong>props manipulation</strong>: 

<ul>
<li>instance of that class can be assigned with values via props. </li>
<li>prop attributes such as name, order index, user defined extras, etc can be used in building requests, DSLs, etc. </li>
</ul>
</li>
<li>
<strong>extended methods</strong> on instance of that class such as equal, copy, toString, hashCode</li>
</ul>

<h3>
<a id="defining-scheme" class="anchor" href="#defining-scheme" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Defining Scheme</h3>

<ul>
<li>
<p>Scheme of class T can be defined by extending class SCHEMAof. And for each exposing field of class T the corresponding prop in the scheme should be created.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17268824/1d5ed856-563f-11e6-9d4f-adf36bb23e73.png" alt="smf_define_scheme"></p>
</blockquote>
</li>
<li>
<p>A prop name and type argument should match the field name and type (no matter nullable or not).</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17268867/4672d174-5640-11e6-8180-731760e837e1.png" alt="smf_define_props"></p>
</blockquote>
</li>
<li>
<p>Props can be constructed via methods in scheme class that start from  '<strong>PROP_...</strong>'.<br>
The following prop types are supported:  </p>

<blockquote>
<table>
<thead>
<tr>
<th>Type</th>
<th>Constructor</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Unit</code></td>
<td>PROP_STUB()</td>
<td>for <em>stub</em> props</td>
</tr>
<tr>
<td>Primitive types</td>
<td>PROP_Long() ...</td>
<td>All primitive types: <code>Long</code>, <code>Int</code>, etc.</td>
</tr>
<tr>
<td><code>String</code></td>
<td>PROP_String()</td>
<td>String type</td>
</tr>
<tr>
<td>Primitive arrays</td>
<td>PROP_Longs() ...</td>
<td>All primitive arrays: <code>LongArray</code>, <code>IntArray</code>, etc.</td>
</tr>
<tr>
<td><code>MutableMap&lt;String, Any?&gt;</code></td>
<td>PROP_Map()</td>
<td>Raw map type</td>
</tr>
<tr>
<td><code>Array&lt;Any?&gt;</code></td>
<td>PROP_Array()</td>
<td>Raw array type</td>
</tr>
<tr>
<td><code>Collection&lt;Any?&gt;</code></td>
<td>PROP_Collection()</td>
<td>Raw collection type</td>
</tr>
<tr>
<td>Any</td>
<td>PROP_of(type)</td>
<td>Scheme type //TODO</td>
</tr>
<tr>
<td>Any</td>
<td>PROP_AutoSchemaOf(type)</td>
<td>AutoSchema type //TODO</td>
</tr>
<tr>
<td>Any</td>
<td>PROP_of(type)</td>
<td>Value type //TODO</td>
</tr>
<tr>
<td>Any</td>
<td>PROP_???()</td>
<td>Sequence type //TODO</td>
</tr>
</tbody>
</table>
</blockquote>
</li>
<li>
<p>Prop has index indicating its declaration position within schema.<br>
Position of prop in scheme should NOT match the position of corresponding field in schemified class.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269101/59a43028-5648-11e6-9314-92554abd7ccd.png" alt="smf_prop_indexes"></p>
</blockquote>
</li>
<li>
<p>Prop should be assigned via delegation and not by ‘=’ sign. That’s because prop should be initialized lazily.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269119/e8208572-5648-11e6-9683-48053a1946a3.png" alt="smf_prop_assign_by"></p>
</blockquote>
</li>
<li>
<p>By default variable field <strong><code>var</code></strong> can be modified and final field <strong><code>val</code></strong> can not be modified via corresponding prop. But default behavior can be altered by setting method argument <code>writeProtected</code>.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269164/7444781e-564a-11e6-9170-2164faabb951.png" alt="smf_write_protect"></p>
</blockquote>
</li>
<li>
<p>Field with access modifier (private etc) is still accessible via corresponding prop.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269200/047134d6-564b-11e6-8e18-86708d401c18.png" alt="smf_prop_access"></p>
</blockquote>
</li>
<li>
<p>By default prop is configured to use Kotlin reflection instead of Java’s one to access related field. It’s slower (about 2 times) but it’s required in order to invoke field’s custom accessors. But if field doesn’t have custom getter or setter than it may be reasonable to configure prop to use Java reflection by setting method argument <code>hasNoAccessors</code> to true.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269236/cedcd720-564b-11e6-83cc-76be5bc857fd.png" alt="smf_prop_accessors"></p>
</blockquote>
</li>
<li>
<p>If schemified class has main non-empty constructor it should only have class fields (<code>val</code> or <code>var</code>) as arguments and only those fields that have corresponding props in scheme.<br>
Order of fields in constructor doesn’t matter.<br>
Constructor with access modifier is still accessible by scheme.<br>
API also can not distinguish whether the constructor argument is class field or just local initialization value. So be careful to declare constructor argument with val/var.</p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17269308/7da7c340-564d-11e6-8a19-61addebfc88e.png" alt="smf_constructor"></p>
</blockquote>
</li>
<li><p>If a prop doesn’t have the related field in schemified class accessing it will just return null value.<br>
To explicitly declare a prop that doesn’t have the related field it should be created via PROP_STUB() method which returns prop of type Prop. It’s useful when using compact representation and zero evolution scheme (see next).</p></li>
</ul>

<hr>

<h2>
<a id="serialization-api" class="anchor" href="#serialization-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Serialization API</h2>

<p><strong>Container</strong> of <strong>entries</strong> represented in one <strong>format</strong> can be transformed to another format.  </p>

<blockquote>
<p><img src="https://cloud.githubusercontent.com/assets/5307477/17268380/84b1451a-5631-11e6-95a9-aceacb1fe1ca.png" alt="ser_examples"></p>
</blockquote>

<p><strong>Container</strong> of type OUT is created by calling <em>Produce(reader: Reader, writer: Writer)</em>.
Reader extracts entries from a container of type IN. Those are passed to Writer which writes them to the container of type OUT.<br>
There are default implementations of Reader and Writer for Json, Xml and Scheme format. For convenience there are also factory singletons for creating their instances.<br>
<em>Examples:</em></p>

<div class="highlight highlight-source-scala"><pre><span class="pl-k">val</span> <span class="pl-en">orderJson</span> <span class="pl-k">=</span> <span class="pl-en">Produce</span>(<span class="pl-en">SchemeReader</span>(order1, <span class="pl-en">OrderScheme</span>), <span class="pl-en">JsonFactory</span>())
<span class="pl-k">val</span> <span class="pl-en">order2</span> <span class="pl-k">=</span> <span class="pl-en">Produce</span>(<span class="pl-en">JsonFactory</span>(orderJson), <span class="pl-en">SchemeWriter</span>(<span class="pl-en">OrderScheme</span>))</pre></div>

<p>Entry is a holder of some data. Entry can be named (holding name-value pair) or non-named (holding just value).<br>
Container representation should conform the structure:</p>

<p><img src="https://cloud.githubusercontent.com/assets/5307477/17268685/76de9650-563a-11e6-91e4-6aeb7ac79034.png" alt="ser_flow"></p>

<p>Specific symbols for concrete records, their delimiters and way of encoding named-entry are up to Reader and Writer implementation.<br>
Atomic value is a data of following base types: String, ByteArray and all the java primitive types.</p>

<p>To implement custom Reader class Reader should be extended. And the following methods should be implemented:</p>

<div class="highlight highlight-source-scala"><pre><span class="pl-k">def</span> <span class="pl-en">readRootEntry</span>(<span class="pl-v">entryBuilder</span>: <span class="pl-en">EntryBuilder</span>)<span class="pl-k">:</span> <span class="pl-en">Entry</span>
<span class="pl-k">def</span> <span class="pl-en">readNextEntry</span>(<span class="pl-v">entryBuilder</span>: <span class="pl-en">EntryBuilder</span>, <span class="pl-v">contextIsSequence</span>: <span class="pl-k">Boolean</span>)<span class="pl-k">:</span> <span class="pl-en">Entry</span></pre></div>

<p>To implement custom Writer class Writer should be extended. And the following methods should be implemented:</p>

<div class="highlight highlight-source-scala"><pre><span class="pl-k">def</span> <span class="pl-en">result</span>()<span class="pl-k">:</span> <span class="pl-en">T</span><span class="pl-k">?</span>
<span class="pl-k">def</span> <span class="pl-en">writeRootEntry</span>(<span class="pl-v">isSequence</span>: <span class="pl-k">Boolean</span>, <span class="pl-v">content</span>: <span class="pl-en">EnclosingEntries</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span>
<span class="pl-k">def</span> <span class="pl-en">writeObjectEntry</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span><span class="pl-k">?</span>, <span class="pl-v">index</span>: <span class="pl-k">Int</span>, <span class="pl-v">content</span>: <span class="pl-en">EnclosingEntries</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span>
<span class="pl-k">def</span> <span class="pl-en">writeSequenceEntry</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span><span class="pl-k">?</span>, <span class="pl-v">index</span>: <span class="pl-k">Int</span>, <span class="pl-v">content</span>: <span class="pl-en">EnclosingEntries</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span>
<span class="pl-k">def</span> <span class="pl-en">writeAtomicEntry</span>(<span class="pl-v">value</span>: [all atomic types], <span class="pl-v">name</span>: <span class="pl-k">String</span><span class="pl-k">?</span>, <span class="pl-v">index</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span></pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/just-4-fun/SchemifyKt">Schemify.Kt</a> is maintained by <a href="https://github.com/just-4-fun">just-4-fun</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
